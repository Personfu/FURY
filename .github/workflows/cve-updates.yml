name: FURY Daily CVE Sync

on:
    schedule:
        - cron: "0 0 * * *" # Every day at midnight
    workflow_dispatch:

jobs:
    update-cve:
        runs-on: ubuntu-latest
        permissions:
            contents: write
        steps:
            - name: Checkout Repository
              uses: actions/checkout@v4

            - name: Fetch and Sync CVE Intelligence
              run: |
                  python3 scripts/cve_sync.py
                  date > fury_arsenal/data/last_sync.txt

            - name: Commit and Push Updates
              run: |
                  git config --global user.name "fury-bot"
                  git config --global user.email "bot@fury.fllc"
                  git add fury_arsenal/data/
                  git commit -m "Auto-Update: CVE Intelligence Database [$(date +'%Y-%m-%d')]" || echo "No changes to commit"
                  git push

    release:
        needs: update-cve
        runs-on: ubuntu-latest
        permissions:
            contents: write
        steps:
            - name: Checkout Repository
              uses: actions/checkout@v4
              with:
                  fetch-depth: 0

            - name: Auto-Release
              uses: softprops/action-gh-release@v1
              with:
                  tag_name: "v7.0-sync-$(date +'%Y%m%d')"
                  name: "NEBULA Sync [$(date +'%Y-%m-%d')]"
                  body: "Automated daily intelligence sync and FURY v7.0 maintenance release."
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
